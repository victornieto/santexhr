;(function(){oltk.namespace('oltk.bravo.history');oltk.include('oltk/bravo/bravo.js');oltk.include('oltk/bravo/history/HistoryManager.js');var self=oltk.bravo.history.SingleActionHistory={_defaultCommand:null,init:function(onReady,scope){oltk.bravo.history.HistoryManager.addHistoryChangeListener(self._dispatch);oltk.bravo.history.HistoryManager.init(function(token){var action=self._parseCommand(token);onReady.call(scope,action,self);});},setDefaultAction:function(controller,action){var cmd=new Command();cmd.controller=controller;cmd.action=action;cmd.params={};self._defaultCommand=cmd;},getDefaultAction:function(){return self._defaultCommand;},_dispatch:function(token){if(!token){if(self._defaultCommand){self._defaultCommand.execute();}}else{var cmd=self._parseCommand(token);if(cmd){cmd.execute();}}},_parseCommand:function(s){s=s||'';var m=s.match(/(.+?)\/(.+?)&(.+)/)||s.match(/(.+?)\/(.+)/);if(m){var cmd=new Command();cmd.controller=m[1];cmd.action=m[2];cmd.params=self._parseParams(m[3]);return cmd;}else{return null;}},_parseParams:function(s){s=s||'';var result={};var params=s.split('&');for(var i=0;i<params.length;i++){var tokens=params[i].split('=');if(tokens.length>=2){result[tokens[0]]=decodeURIComponent(tokens[1]);}}
return result;}};function Command(){this.controller;this.action;this.params;};Command.prototype.execute=function(){oltk.bravo.execute(this.controller,this.action,this.params);};})();