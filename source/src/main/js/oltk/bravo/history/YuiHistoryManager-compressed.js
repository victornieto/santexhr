;(function(){oltk.namespace('oltk.bravo.history');oltk.include('yui/yahoo/yahoo.js');oltk.include('yui/event/event.js');oltk.include('yui/history/history.js');oltk.include('yui/json/json.js');oltk.include('jquery/jquery.js');var self=oltk.bravo.history.YuiHistoryManager={_callbacks:{},initialize:function(o){o=jQuery.extend({defaultState:oltk.emptyFn,onDomReady:oltk.emptyFn,onStateReady:oltk.emptyFn},o);YAHOO.util.Event.onDOMReady(function(){o.onDomReady();jQuery('<input id="oltk-history-field" type="hidden"/>').prependTo(document.body);if(YAHOO.env.ua.ie){jQuery('<iframe id="oltk-history-iframe" src="javascript:false;" style="position:absolute;top:0px;left:0px;width:1px;height:1px;visibility:hidden"></iframe>').prependTo(document.body);}
YAHOO.util.History.onReady(function(){if(!self._restoreToBookmarkState()){o.defaultState();}
o.onStateReady();});try{YAHOO.util.History.initialize('oltk-history-field','oltk-history-iframe');}catch(e){oltk.log.warn('History.initialize: ',e);o.defaultState();o.onStateReady();}});},register:function(moduleId,onHistoryChange){if(self._callbacks[moduleId]){return;}
var callback=self._wrapCallback(moduleId,onHistoryChange);var initialState=YAHOO.util.History.getBookmarkedState(moduleId)||YAHOO.lang.JSON.stringify('');YAHOO.util.History.register(moduleId,initialState,callback);self._callbacks[moduleId]=callback;},bookmark:function(moduleId,state){if(!YAHOO.util.Lang.isValue(moduleId)){return;}
state=YAHOO.lang.JSON.stringify(state);moduleId=moduleId+'';if(self._isCurrentStateOf(moduleId,state)){return;}
try{self._callbacks[moduleId].prevent=true;YAHOO.util.History.navigate(moduleId,state);}catch(e){oltk.log.warn('History.bookmark: ',e);self._callbacks[moduleId].prevent=false;}},_wrapCallback:function(moduleId,onHistoryChange){return function(state){if(self._callbacks[moduleId].prevent){self._callbacks[moduleId].prevent=false;return;}
var o='';try{o=YAHOO.lang.JSON.parse(state)}catch(e){oltk.log.warn('History._wrapCallback: state='+state,e);}
onHistoryChange.call(null,o);};},_isCurrentStateOf:function(moduleId,state){return YAHOO.util.History.getCurrentState(moduleId)==state;},_restoreToBookmarkState:function(){var result=false;for(var id in self._callbacks){if(!YAHOO.util.Lang.hasOwnProperty(self._callbacks,id)){continue;}
var state=YAHOO.util.History.getCurrentState(id);self._callbacks[id].call(null,state);result=true;}
return result;}};(function(){if(!YAHOO.env.ua.ie){return;}
top.location.hash=top.location.hash;})();})();